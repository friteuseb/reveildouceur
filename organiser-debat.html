<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Organiser un débat entre amis - Réveil Douceur</title>
  <meta name="description" content="Guide complet pour organiser une soirée débat entre amis. Choisissez vos thématiques, créez une session de vote et préparez vos arguments avec des sources fiables.">

  <!-- Open Graph -->
  <meta property="og:title" content="Organiser un débat entre amis - Réveil Douceur">
  <meta property="og:description" content="Guide complet pour organiser une soirée débat entre amis basée sur des sources fiables.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://reveildouceur.fr/organiser-debat.html">

  <!-- Styles -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/config.js"></script>

  <style>
    /* Styles spécifiques - Page compacte */

    /* Hero compact */
    .debat-hero {
      background: linear-gradient(135deg, var(--color-bg) 0%, var(--color-bg-alt) 100%);
      padding: var(--space-xl) 0 var(--space-2xl);
      text-align: center;
      border-bottom: 1px solid var(--color-border);
    }

    .debat-hero__title {
      margin-bottom: var(--space-sm);
      font-size: clamp(1.75rem, 4vw, 2.5rem);
    }

    .debat-hero__subtitle {
      color: var(--color-text-light);
      max-width: 650px;
      margin: 0 auto var(--space-lg);
      font-size: 1rem;
      line-height: 1.6;
    }

    .debat-hero__cta {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
    }

    /* Sections compactes */
    .debat-section {
      padding: var(--space-2xl) 0;
    }

    .debat-section--alt {
      background: var(--color-bg-alt);
    }

    .debat-section__header {
      text-align: center;
      max-width: 650px;
      margin: 0 auto var(--space-xl);
    }

    .debat-section__title {
      font-size: clamp(1.25rem, 3vw, 1.75rem);
      margin-bottom: var(--space-xs);
    }

    .debat-section__intro {
      color: var(--color-text-light);
      font-size: 0.9375rem;
      line-height: 1.6;
    }

    /* Grille compacte pourquoi */
    .pourquoi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--space-md);
    }

    .pourquoi-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: var(--space-md);
      transition: all var(--transition);
    }

    .pourquoi-card:hover {
      border-color: var(--color-primary);
      box-shadow: var(--shadow);
    }

    .pourquoi-card__title {
      font-size: 1rem;
      margin-bottom: var(--space-xs);
      color: var(--color-text);
    }

    .pourquoi-card__text {
      font-size: 0.875rem;
      color: var(--color-text-light);
      line-height: 1.5;
      margin: 0;
    }

    /* CTA intermédiaire */
    .cta-banner {
      text-align: center;
      padding: var(--space-lg);
      background: var(--color-primary);
      color: #fff;
      border-radius: var(--radius);
      margin: var(--space-xl) 0;
    }

    .cta-banner__text {
      margin: 0 0 var(--space-md);
      font-size: 1rem;
    }

    .cta-banner .btn {
      background: #fff;
      color: var(--color-primary);
      border-color: #fff;
    }

    .cta-banner .btn:hover {
      background: var(--color-bg);
    }

    /* Règles compactes */
    .regles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-md);
      max-width: 900px;
      margin: 0 auto;
    }

    .regle-item {
      display: flex;
      gap: var(--space-sm);
      padding: var(--space-md);
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
    }

    .regle-item__number {
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      background: var(--color-primary);
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8125rem;
      font-weight: 600;
    }

    .regle-item__content h3 {
      font-size: 0.9375rem;
      margin-bottom: 0.25rem;
      color: var(--color-text);
    }

    .regle-item__content p {
      font-size: 0.8125rem;
      color: var(--color-text-light);
      margin: 0;
      line-height: 1.5;
    }

    /* Étapes compactes */
    .etapes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-md);
      max-width: 1000px;
      margin: 0 auto;
    }

    .etape-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: var(--space-md);
      position: relative;
    }

    .etape-card__number {
      position: absolute;
      top: calc(-1 * var(--space-sm));
      left: var(--space-md);
      background: var(--color-primary);
      color: #fff;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .etape-card__timing {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-primary);
      margin-bottom: var(--space-xs);
      margin-top: var(--space-xs);
    }

    .etape-card__title {
      font-size: 0.9375rem;
      margin-bottom: var(--space-xs);
      color: var(--color-text);
    }

    .etape-card__text {
      font-size: 0.8125rem;
      color: var(--color-text-light);
      margin: 0;
      line-height: 1.5;
    }

    /* Formats compacts */
    .formats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-md);
      max-width: 900px;
      margin: 0 auto;
    }

    .format-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: var(--space-md);
      border-top: 3px solid var(--color-primary);
    }

    .format-card--recommande {
      border-top-color: #f6ad55;
    }

    .format-card__header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--space-sm);
    }

    .format-card__title {
      font-size: 1rem;
      margin: 0;
      color: var(--color-text);
    }

    .format-card__badge {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      background: #f6ad55;
      color: #fff;
      padding: 0.125rem 0.375rem;
      border-radius: 3px;
    }

    .format-card__duration {
      font-size: 0.8125rem;
      color: var(--color-primary);
      font-weight: 500;
      margin-bottom: var(--space-sm);
    }

    .format-card__desc {
      font-size: 0.8125rem;
      color: var(--color-text-light);
      line-height: 1.5;
      margin: 0;
    }

    /* === NOUVELLE SECTION: MODE TABS === */
    .mode-tabs {
      display: flex;
      justify-content: center;
      gap: var(--space-xs);
      margin-bottom: var(--space-lg);
    }

    .mode-tab {
      padding: var(--space-sm) var(--space-lg);
      background: var(--color-surface);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-full);
      cursor: pointer;
      font-size: 0.9375rem;
      font-weight: 500;
      color: var(--color-text);
      transition: all var(--transition);
    }

    .mode-tab:hover {
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    .mode-tab--active {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: #fff;
    }

    .mode-panel {
      display: none;
    }

    .mode-panel--active {
      display: block;
    }

    /* Section session */
    .session-box {
      background: var(--color-surface);
      border: 2px solid var(--color-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      max-width: 600px;
      margin: 0 auto var(--space-xl);
    }

    .session-box__title {
      font-size: 1.125rem;
      margin-bottom: var(--space-md);
      text-align: center;
    }

    .session-box__form {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .form-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--color-text);
    }

    .form-group input,
    .form-group select {
      padding: var(--space-sm) var(--space-md);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      font-size: 1rem;
      background: var(--color-bg);
      color: var(--color-text);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--color-primary);
    }

    /* Code de session */
    .session-code-display {
      text-align: center;
      padding: var(--space-lg);
      background: var(--color-bg-alt);
      border-radius: var(--radius);
      margin: var(--space-md) 0;
    }

    .session-code-display__label {
      font-size: 0.875rem;
      color: var(--color-text-light);
      margin-bottom: var(--space-xs);
    }

    .session-code-display__code {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: monospace;
      letter-spacing: 0.2em;
      color: var(--color-primary);
    }

    .session-code-display__url {
      font-size: 0.75rem;
      color: var(--color-text-light);
      margin-top: var(--space-sm);
      word-break: break-all;
    }

    /* Résultats de vote */
    .vote-results {
      margin-top: var(--space-lg);
    }

    .vote-results__title {
      font-size: 1rem;
      margin-bottom: var(--space-md);
    }

    .vote-result-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm);
      background: var(--color-bg);
      border-radius: var(--radius);
      margin-bottom: var(--space-xs);
    }

    .vote-result-item__rank {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--color-primary);
      min-width: 24px;
    }

    .vote-result-item__bar {
      flex: 1;
      height: 24px;
      background: var(--color-border);
      border-radius: var(--radius);
      overflow: hidden;
      position: relative;
    }

    .vote-result-item__fill {
      height: 100%;
      background: var(--color-primary);
      transition: width 0.5s ease;
    }

    .vote-result-item__title {
      position: absolute;
      left: var(--space-sm);
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.75rem;
      color: var(--color-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: calc(100% - 60px);
    }

    .vote-result-item__count {
      min-width: 50px;
      text-align: right;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text);
    }

    /* Participants */
    .participants-list {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
      margin-top: var(--space-sm);
    }

    .participant-tag {
      padding: 0.25rem 0.5rem;
      background: var(--color-bg-alt);
      border-radius: var(--radius);
      font-size: 0.75rem;
      color: var(--color-text-light);
    }

    /* Section sélection */
    .selection-section {
      background: var(--color-surface);
      border: 2px solid var(--color-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      max-width: 900px;
      margin: 0 auto;
    }

    .selection-section__header {
      text-align: center;
      margin-bottom: var(--space-lg);
    }

    .selection-section__title {
      font-size: 1.25rem;
      margin-bottom: var(--space-xs);
    }

    .selection-section__subtitle {
      color: var(--color-text-light);
      font-size: 0.9375rem;
      margin: 0;
    }

    /* Filtres */
    .selection-filters {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
      margin-bottom: var(--space-md);
      justify-content: center;
    }

    .selection-filter {
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: all var(--transition);
      color: var(--color-text);
    }

    .selection-filter:hover {
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    .selection-filter--active {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: #fff;
    }

    /* Liste articles */
    .article-list {
      display: grid;
      gap: var(--space-xs);
      max-height: 400px;
      overflow-y: auto;
      padding-right: var(--space-xs);
      margin-bottom: var(--space-md);
    }

    .article-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all var(--transition);
    }

    .article-item:hover {
      border-color: var(--color-primary);
    }

    .article-item--selected {
      border-color: var(--color-primary);
      background: rgba(91, 123, 111, 0.08);
    }

    [data-theme="dark"] .article-item--selected {
      background: rgba(122, 155, 143, 0.15);
    }

    .article-item__checkbox {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      border: 2px solid var(--color-border);
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition);
    }

    .article-item--selected .article-item__checkbox {
      background: var(--color-primary);
      border-color: var(--color-primary);
    }

    .article-item__checkbox svg {
      opacity: 0;
      color: #fff;
    }

    .article-item--selected .article-item__checkbox svg {
      opacity: 1;
    }

    .article-item__content {
      flex: 1;
      min-width: 0;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }

    .article-item__category {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: #fff;
      padding: 0.125rem 0.375rem;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .article-item__title {
      font-size: 0.875rem;
      color: var(--color-text);
      line-height: 1.3;
    }

    /* Résumé sélection */
    .selection-summary {
      padding: var(--space-md);
      background: var(--color-bg-alt);
      border-radius: var(--radius);
      margin-bottom: var(--space-md);
    }

    .selection-summary__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-sm);
    }

    .selection-summary__count {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--color-text);
    }

    .selection-summary__count span {
      color: var(--color-primary);
    }

    .selected-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
    }

    .selected-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      background: var(--color-primary);
      color: #fff;
      font-size: 0.75rem;
      border-radius: var(--radius);
    }

    .selected-tag__remove {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      padding: 0;
      display: flex;
      opacity: 0.7;
    }

    .selected-tag__remove:hover {
      opacity: 1;
    }

    /* Actions export */
    .selection-actions {
      display: flex;
      gap: var(--space-sm);
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Tips compact */
    .tips-box {
      padding: var(--space-md);
      background: rgba(91, 123, 111, 0.1);
      border: 1px solid var(--color-primary);
      border-radius: var(--radius);
      margin-top: var(--space-xl);
    }

    [data-theme="dark"] .tips-box {
      background: rgba(122, 155, 143, 0.1);
    }

    .tips-box__title {
      font-size: 0.9375rem;
      margin-bottom: var(--space-sm);
      color: var(--color-text);
    }

    .tips-box__list {
      margin: 0;
      padding-left: var(--space-lg);
      font-size: 0.8125rem;
      color: var(--color-text-light);
    }

    .tips-box__list li {
      margin-bottom: 0.25rem;
    }

    /* Info box */
    .info-box {
      padding: var(--space-md);
      background: rgba(49, 130, 206, 0.1);
      border: 1px solid #3182ce;
      border-radius: var(--radius);
      margin-bottom: var(--space-md);
      font-size: 0.875rem;
      color: var(--color-text);
    }

    .info-box strong {
      color: #3182ce;
    }

    /* Vote limit indicator */
    .vote-limit {
      text-align: center;
      padding: var(--space-sm);
      background: var(--color-bg-alt);
      border-radius: var(--radius);
      margin-bottom: var(--space-md);
      font-size: 0.875rem;
    }

    .vote-limit__count {
      font-weight: 700;
      color: var(--color-primary);
    }

    .vote-limit--exceeded {
      background: rgba(229, 62, 62, 0.1);
      border: 1px solid #e53e3e;
    }

    .vote-limit--exceeded .vote-limit__count {
      color: #e53e3e;
    }

    /* Responsive */
    @media (max-width: 640px) {
      .debat-section {
        padding: var(--space-xl) 0;
      }

      .selection-section,
      .session-box {
        padding: var(--space-md);
        margin: 0 calc(-1 * var(--space-md));
        border-radius: 0;
        border-left: none;
        border-right: none;
      }

      .selection-summary__header {
        flex-direction: column;
        gap: var(--space-sm);
        align-items: flex-start;
      }

      .regles-grid {
        grid-template-columns: 1fr;
      }

      .mode-tabs {
        flex-direction: column;
        align-items: stretch;
      }

      .mode-tab {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Aller au contenu principal</a>

  <div id="header-include"></div>

  <main id="main-content">
    <!-- Hero -->
    <section class="debat-hero">
      <div class="container">
        <h1 class="debat-hero__title">Organisez un débat entre amis</h1>
        <p class="debat-hero__subtitle">
          Transformez vos soirées en moments d'échange enrichissants. Créez une session de vote,
          invitez vos amis et choisissez ensemble les sujets à débattre.
        </p>
        <a href="#selection" class="btn btn--primary debat-hero__cta">
          Créer une session de vote
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12l7 7 7-7"/>
          </svg>
        </a>
      </div>
    </section>

    <!-- Pourquoi -->
    <section class="debat-section">
      <div class="container">
        <div class="debat-section__header">
          <h2 class="debat-section__title">Pourquoi débattre entre amis ?</h2>
          <p class="debat-section__intro">
            Sortez des bulles de filtre, confrontez vos idées et apprenez ensemble.
          </p>
        </div>

        <div class="pourquoi-grid">
          <div class="pourquoi-card">
            <h3 class="pourquoi-card__title">Esprit critique</h3>
            <p class="pourquoi-card__text">
              Argumenter et chercher des preuves oblige à structurer sa pensée.
            </p>
          </div>
          <div class="pourquoi-card">
            <h3 class="pourquoi-card__title">Liens renforcés</h3>
            <p class="pourquoi-card__text">
              Des échanges respectueux sur des sujets profonds créent une vraie complicité.
            </p>
          </div>
          <div class="pourquoi-card">
            <h3 class="pourquoi-card__title">Apprentissage collectif</h3>
            <p class="pourquoi-card__text">
              Chacun apporte son expertise, ses lectures et son vécu.
            </p>
          </div>
          <div class="pourquoi-card">
            <h3 class="pourquoi-card__title">Dépasser les clivages</h3>
            <p class="pourquoi-card__text">
              Se concentrer sur les faits révèle souvent des points communs insoupçonnés.
            </p>
          </div>
        </div>

        <div class="cta-banner">
          <p class="cta-banner__text">Prêt à organiser votre première soirée débat ?</p>
          <a href="#selection" class="btn">Créer une session de vote</a>
        </div>
      </div>
    </section>

    <!-- Règles du débat -->
    <section class="debat-section debat-section--alt">
      <div class="container">
        <div class="debat-section__header">
          <h2 class="debat-section__title">Les règles d'or du débat bienveillant</h2>
          <p class="debat-section__intro">
            Un bon débat n'est pas une bataille, mais une exploration commune.
          </p>
        </div>

        <div class="regles-grid">
          <div class="regle-item">
            <span class="regle-item__number">1</span>
            <div class="regle-item__content">
              <h3>Écouter avant de répondre</h3>
              <p>Reformulez ce que vous avez compris avant de donner votre avis.</p>
            </div>
          </div>
          <div class="regle-item">
            <span class="regle-item__number">2</span>
            <div class="regle-item__content">
              <h3>Sourcer ses affirmations</h3>
              <p>Distinguez faits vérifiables et opinions personnelles.</p>
            </div>
          </div>
          <div class="regle-item">
            <span class="regle-item__number">3</span>
            <div class="regle-item__content">
              <h3>Accepter la nuance</h3>
              <p>Reconnaissez quand un argument adverse a du mérite.</p>
            </div>
          </div>
          <div class="regle-item">
            <span class="regle-item__number">4</span>
            <div class="regle-item__content">
              <h3>Attaquer les idées, pas les personnes</h3>
              <p>Évitez les jugements personnels, concentrez-vous sur les arguments.</p>
            </div>
          </div>
          <div class="regle-item">
            <span class="regle-item__number">5</span>
            <div class="regle-item__content">
              <h3>Accepter de changer d'avis</h3>
              <p>C'est une force, pas une faiblesse.</p>
            </div>
          </div>
          <div class="regle-item">
            <span class="regle-item__number">6</span>
            <div class="regle-item__content">
              <h3>Respecter le temps de parole</h3>
              <p>Chacun doit pouvoir s'exprimer équitablement.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Comment organiser -->
    <section class="debat-section">
      <div class="container">
        <div class="debat-section__header">
          <h2 class="debat-section__title">Comment organiser votre soirée</h2>
        </div>

        <div class="etapes-grid">
          <div class="etape-card">
            <span class="etape-card__number">1</span>
            <span class="etape-card__timing">Maintenant</span>
            <h3 class="etape-card__title">Créer une session</h3>
            <p class="etape-card__text">Sélectionnez des articles et créez un code de session à partager.</p>
          </div>
          <div class="etape-card">
            <span class="etape-card__number">2</span>
            <span class="etape-card__timing">Avant le débat</span>
            <h3 class="etape-card__title">Inviter les amis</h3>
            <p class="etape-card__text">Partagez le code. Chacun vote pour ses sujets préférés.</p>
          </div>
          <div class="etape-card">
            <span class="etape-card__number">3</span>
            <span class="etape-card__timing">Quelques jours avant</span>
            <h3 class="etape-card__title">Consulter les résultats</h3>
            <p class="etape-card__text">Voyez les sujets les plus populaires et préparez le débat.</p>
          </div>
          <div class="etape-card">
            <span class="etape-card__number">4</span>
            <span class="etape-card__timing">Le jour J</span>
            <h3 class="etape-card__title">Débattre</h3>
            <p class="etape-card__text">4-8 personnes, les règles affichées, et c'est parti !</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Formats -->
    <section class="debat-section debat-section--alt">
      <div class="container">
        <div class="debat-section__header">
          <h2 class="debat-section__title">Choisissez votre format</h2>
        </div>

        <div class="formats-grid">
          <div class="format-card format-card--recommande">
            <div class="format-card__header">
              <h3 class="format-card__title">Le café-débat</h3>
              <span class="format-card__badge">Recommandé</span>
            </div>
            <p class="format-card__duration">1h30 - 2h | 4-6 personnes</p>
            <p class="format-card__desc">
              Format décontracté, idéal pour débuter. Un seul sujet, discussion libre avec modération légère.
            </p>
          </div>
          <div class="format-card">
            <div class="format-card__header">
              <h3 class="format-card__title">Le débat structuré</h3>
            </div>
            <p class="format-card__duration">2h - 2h30 | 6-10 personnes</p>
            <p class="format-card__desc">
              Format plus formel avec temps de parole définis. Idéal pour des sujets complexes.
            </p>
          </div>
          <div class="format-card">
            <div class="format-card__header">
              <h3 class="format-card__title">L'avocat du diable</h3>
            </div>
            <p class="format-card__duration">1h30 | 4-8 personnes</p>
            <p class="format-card__desc">
              Chacun défend une position assignée au hasard. Excellent pour la prise de recul.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Sélection des articles et Session de vote -->
    <section class="debat-section" id="selection">
      <div class="container">
        <div class="debat-section__header">
          <h2 class="debat-section__title">Sessions de vote</h2>
          <p class="debat-section__intro">
            Créez une session pour que vos amis votent, ou rejoignez une session existante.
          </p>
        </div>

        <!-- Onglets de mode -->
        <div class="mode-tabs">
          <button class="mode-tab mode-tab--active" data-mode="create">Créer une session</button>
          <button class="mode-tab" data-mode="join">Rejoindre une session</button>
          <button class="mode-tab" data-mode="results">Voir les résultats</button>
        </div>

        <!-- Panel: Créer une session -->
        <div class="mode-panel mode-panel--active" id="panel-create">
          <div class="session-box">
            <h3 class="session-box__title">Nouvelle session de débat</h3>

            <div class="session-box__form" id="create-session-form">
              <div class="form-group">
                <label for="session-name">Nom de la session</label>
                <input type="text" id="session-name" placeholder="Ex: Soirée débat du 15 janvier" maxlength="100">
              </div>
              <div class="form-group">
                <label for="max-votes">Nombre de votes par participant</label>
                <select id="max-votes">
                  <option value="1">1 vote</option>
                  <option value="2">2 votes</option>
                  <option value="3" selected>3 votes</option>
                  <option value="5">5 votes</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Sélection des articles -->
          <div class="selection-section">
            <div class="selection-section__header">
              <h3 class="selection-section__title">Choisissez les articles proposés au vote</h3>
              <p class="selection-section__subtitle">Cliquez pour sélectionner (min. 2 articles)</p>
            </div>

            <!-- Filtres -->
            <div class="selection-filters" id="category-filters">
              <button class="selection-filter selection-filter--active" data-category="">Tous</button>
            </div>

            <!-- Liste des articles -->
            <div class="article-list" id="article-list">
              <div class="loader">
                <div class="loader__spinner"></div>
              </div>
            </div>

            <!-- Résumé sélection -->
            <div class="selection-summary" id="selection-summary" style="display: none;">
              <div class="selection-summary__header">
                <span class="selection-summary__count">
                  <span id="selection-count">0</span> article(s) sélectionné(s)
                </span>
                <button class="btn btn--secondary" id="clear-selection" style="padding: 0.25rem 0.75rem; font-size: 0.75rem;">
                  Effacer tout
                </button>
              </div>
              <div class="selected-tags" id="selected-tags"></div>
            </div>

            <!-- Actions -->
            <div class="selection-actions">
              <button class="btn btn--primary" id="create-session-btn" disabled>
                Créer la session de vote
              </button>
            </div>
          </div>

          <!-- Session créée -->
          <div id="session-created" style="display: none;">
            <div class="session-box">
              <h3 class="session-box__title">Session créée avec succès !</h3>

              <div class="session-code-display">
                <p class="session-code-display__label">Code de la session</p>
                <p class="session-code-display__code" id="created-session-code">------</p>
                <p class="session-code-display__url" id="created-session-url"></p>
              </div>

              <div class="info-box">
                <strong>Partagez ce code</strong> avec vos amis pour qu'ils puissent voter.
                La session expire dans 72 heures.
              </div>

              <div class="selection-actions">
                <button class="btn btn--primary" id="copy-session-link">
                  Copier le lien
                </button>
                <button class="btn btn--outline" id="share-session-whatsapp">
                  WhatsApp
                </button>
                <button class="btn btn--outline" id="view-session-results">
                  Voir les résultats
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Panel: Rejoindre une session -->
        <div class="mode-panel" id="panel-join">
          <div class="session-box">
            <h3 class="session-box__title">Rejoindre une session</h3>

            <div class="session-box__form" id="join-session-form">
              <div class="form-group">
                <label for="join-code">Code de la session</label>
                <input type="text" id="join-code" placeholder="Ex: ABC123" maxlength="6" style="text-transform: uppercase; letter-spacing: 0.1em; font-family: monospace;">
              </div>
              <div class="form-group">
                <label for="participant-name">Votre prénom</label>
                <input type="text" id="participant-name" placeholder="Ex: Marie" maxlength="50">
              </div>
              <div class="selection-actions">
                <button class="btn btn--primary" id="join-session-btn">
                  Rejoindre
                </button>
              </div>
            </div>
          </div>

          <!-- Interface de vote -->
          <div id="vote-interface" style="display: none;">
            <div class="session-box">
              <h3 class="session-box__title" id="vote-session-name">Session de vote</h3>
              <div class="vote-limit" id="vote-limit">
                Votes restants : <span class="vote-limit__count" id="votes-remaining">3</span>
              </div>
            </div>

            <div class="selection-section">
              <div class="selection-section__header">
                <h3 class="selection-section__title">Votez pour vos sujets préférés</h3>
              </div>

              <div class="article-list" id="vote-article-list"></div>

              <div class="selection-actions">
                <button class="btn btn--primary" id="submit-votes-btn">
                  Enregistrer mes votes
                </button>
              </div>
            </div>
          </div>

          <div id="vote-submitted" style="display: none;">
            <div class="session-box">
              <h3 class="session-box__title">Votes enregistrés !</h3>
              <p style="text-align: center; color: var(--color-text-light);">
                Merci pour votre participation. L'organisateur verra les résultats.
              </p>
              <div class="selection-actions" style="margin-top: var(--space-md);">
                <button class="btn btn--outline" id="view-results-after-vote">
                  Voir les résultats
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Panel: Résultats -->
        <div class="mode-panel" id="panel-results">
          <div class="session-box">
            <h3 class="session-box__title">Consulter les résultats</h3>

            <div class="session-box__form" id="results-form">
              <div class="form-group">
                <label for="results-code">Code de la session</label>
                <input type="text" id="results-code" placeholder="Ex: ABC123" maxlength="6" style="text-transform: uppercase; letter-spacing: 0.1em; font-family: monospace;">
              </div>
              <div class="selection-actions">
                <button class="btn btn--primary" id="view-results-btn">
                  Voir les résultats
                </button>
              </div>
            </div>
          </div>

          <!-- Affichage des résultats -->
          <div id="results-display" style="display: none;">
            <div class="session-box">
              <h3 class="session-box__title" id="results-session-name">Résultats</h3>
              <p style="text-align: center; color: var(--color-text-light);">
                <span id="results-participant-count">0</span> participant(s)
              </p>

              <div class="vote-results" id="vote-results"></div>

              <div id="participants-section" style="margin-top: var(--space-lg);">
                <h4 style="font-size: 0.875rem; margin-bottom: var(--space-xs);">Participants</h4>
                <div class="participants-list" id="participants-list"></div>
              </div>

              <div class="selection-actions" style="margin-top: var(--space-lg);">
                <button class="btn btn--outline" id="refresh-results">
                  Actualiser
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Tips -->
        <div class="tips-box">
          <h4 class="tips-box__title">Conseils pour bien préparer</h4>
          <ul class="tips-box__list">
            <li>Partagez le code de session quelques jours avant pour laisser le temps de voter</li>
            <li>Demandez aux participants de lire les articles gagnants avant le débat</li>
            <li>Préparez quelques questions de relance au cas où la discussion s'essouffle</li>
          </ul>
        </div>
      </div>
    </section>

  </main>

  <div id="footer-include"></div>

  <script src="/js/app.js"></script>
  <script>
    /**
     * Organiser un débat - Sessions de vote
     */
    (function() {
      'use strict';

      const API_URL = '/api/debate-sessions.php';
      const ARTICLES_URL = '/articles/index.json';
      const SITE_URL = 'https://reveildouceur.fr';

      let articlesData = [];
      let categoriesData = {};
      let selectedArticles = [];
      let currentFilter = '';
      let titlesCache = {};

      // État de la session
      let currentSession = null;
      let participantToken = localStorage.getItem('debate-participant-token') || '';
      let votedArticles = [];

      // === UTILITAIRES ===

      function showToast(message, type = 'success') {
        const existing = document.querySelector('.toast');
        if (existing) existing.remove();

        const toast = document.createElement('div');
        toast.className = 'toast';
        const bgColor = type === 'error' ? '#e53e3e' : 'var(--color-primary)';
        toast.style.cssText = `
          position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
          background: ${bgColor}; color: #fff; padding: 12px 24px;
          border-radius: var(--radius); font-size: 0.9375rem; box-shadow: var(--shadow-lg);
          z-index: 1000; animation: fadeInUp 0.3s ease;
        `;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => {
          toast.style.opacity = '0';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      function getArticleTitle(slug) {
        if (titlesCache[slug]) return titlesCache[slug];
        return slug.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
      }

      async function apiCall(action, method = 'GET', data = null) {
        const url = method === 'GET' && data
          ? `${API_URL}?action=${action}&${new URLSearchParams(data)}`
          : `${API_URL}?action=${action}`;

        const options = {
          method,
          headers: { 'Content-Type': 'application/json' }
        };

        if (method === 'POST' && data) {
          options.body = JSON.stringify(data);
        }

        const response = await fetch(url, options);
        const result = await response.json();

        if (!response.ok || result.error) {
          throw new Error(result.error || 'Erreur serveur');
        }

        return result;
      }

      // === GESTION DES ONGLETS ===

      function initTabs() {
        const tabs = document.querySelectorAll('.mode-tab');
        const panels = document.querySelectorAll('.mode-panel');

        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const mode = tab.dataset.mode;

            tabs.forEach(t => t.classList.remove('mode-tab--active'));
            tab.classList.add('mode-tab--active');

            panels.forEach(p => p.classList.remove('mode-panel--active'));
            document.getElementById(`panel-${mode}`).classList.add('mode-panel--active');
          });
        });

        // Vérifier si on arrive avec un paramètre session dans l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const sessionCode = urlParams.get('session');
        if (sessionCode) {
          // Basculer sur l'onglet "Rejoindre"
          document.querySelector('[data-mode="join"]').click();
          document.getElementById('join-code').value = sessionCode.toUpperCase();
        }
      }

      // === CHARGEMENT DES ARTICLES ===

      async function loadArticleTitles() {
        const promises = articlesData.map(async (article) => {
          const slug = article.file.replace('.html', '');
          try {
            const response = await fetch(`/articles/${article.file}`);
            if (response.ok) {
              const html = await response.text();
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');

              let title = doc.querySelector('title')?.textContent;
              if (title) {
                title = title.replace(/\s*[-–—]\s*Réveil Douceur\s*$/i, '').trim();
              }
              if (!title) {
                const h1 = doc.querySelector('h1');
                if (h1) title = h1.textContent.trim();
              }
              if (title) titlesCache[slug] = title;
            }
          } catch (e) {}
        });
        await Promise.all(promises);
        renderArticles();
      }

      function renderFilters() {
        const container = document.getElementById('category-filters');
        let html = '<button class="selection-filter selection-filter--active" data-category="">Tous</button>';
        Object.entries(categoriesData).forEach(([id, cat]) => {
          html += `<button class="selection-filter" data-category="${id}">${cat.label}</button>`;
        });
        container.innerHTML = html;

        container.querySelectorAll('.selection-filter').forEach(btn => {
          btn.addEventListener('click', () => {
            currentFilter = btn.dataset.category;
            container.querySelectorAll('.selection-filter').forEach(b => b.classList.remove('selection-filter--active'));
            btn.classList.add('selection-filter--active');
            renderArticles();
          });
        });
      }

      function renderArticles() {
        const container = document.getElementById('article-list');
        let articles = currentFilter ? articlesData.filter(a => a.category === currentFilter) : articlesData;

        let html = '';
        articles.forEach(article => {
          const slug = article.file.replace('.html', '');
          const isSelected = selectedArticles.includes(slug);
          const category = categoriesData[article.category];

          html += `
            <div class="article-item ${isSelected ? 'article-item--selected' : ''}" data-slug="${slug}">
              <div class="article-item__checkbox">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <div class="article-item__content">
                ${category ? `<span class="article-item__category" style="background-color: ${category.color}">${category.label}</span>` : ''}
                <span class="article-item__title">${getArticleTitle(slug)}</span>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
        container.querySelectorAll('.article-item').forEach(item => {
          item.addEventListener('click', () => toggleArticle(item.dataset.slug));
        });
        updateSummary();
        updateCreateButton();
      }

      function toggleArticle(slug) {
        const idx = selectedArticles.indexOf(slug);
        if (idx === -1) selectedArticles.push(slug);
        else selectedArticles.splice(idx, 1);
        renderArticles();
      }

      function updateSummary() {
        const summary = document.getElementById('selection-summary');
        const countEl = document.getElementById('selection-count');
        const tagsContainer = document.getElementById('selected-tags');

        if (selectedArticles.length === 0) {
          summary.style.display = 'none';
          return;
        }

        summary.style.display = 'block';
        countEl.textContent = selectedArticles.length;

        tagsContainer.innerHTML = selectedArticles.map(slug => `
          <span class="selected-tag">
            ${getArticleTitle(slug).substring(0, 30)}${getArticleTitle(slug).length > 30 ? '...' : ''}
            <button class="selected-tag__remove" data-slug="${slug}">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </span>
        `).join('');

        tagsContainer.querySelectorAll('.selected-tag__remove').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleArticle(btn.dataset.slug);
          });
        });
      }

      function updateCreateButton() {
        const btn = document.getElementById('create-session-btn');
        const sessionName = document.getElementById('session-name').value.trim();
        btn.disabled = selectedArticles.length < 2 || !sessionName;
      }

      function clearSelection() {
        selectedArticles = [];
        renderArticles();
      }

      // === CRÉATION DE SESSION ===

      async function createSession() {
        const name = document.getElementById('session-name').value.trim();
        const maxVotes = parseInt(document.getElementById('max-votes').value);

        if (!name) {
          showToast('Entrez un nom pour la session', 'error');
          return;
        }
        if (selectedArticles.length < 2) {
          showToast('Sélectionnez au moins 2 articles', 'error');
          return;
        }

        try {
          const result = await apiCall('create', 'POST', {
            name,
            articles: selectedArticles,
            maxVotes
          });

          currentSession = result.session;

          // Sauvegarder le token organisateur
          localStorage.setItem(`debate-organizer-${result.session.code}`, result.session.organizerToken);

          // Afficher la confirmation
          document.getElementById('create-session-form').closest('.session-box').style.display = 'none';
          document.querySelector('#panel-create .selection-section').style.display = 'none';
          document.getElementById('session-created').style.display = 'block';

          document.getElementById('created-session-code').textContent = result.session.code;
          document.getElementById('created-session-url').textContent = result.session.shareUrl;

          showToast('Session créée !');

        } catch (error) {
          showToast(error.message, 'error');
        }
      }

      function copySessionLink() {
        if (!currentSession) return;
        const text = `Je vous invite à voter pour notre prochain débat !\n\nRejoignez avec le code: ${currentSession.code}\n\n${currentSession.shareUrl}`;
        navigator.clipboard.writeText(text).then(() => showToast('Lien copié !'));
      }

      function shareSessionWhatsApp() {
        if (!currentSession) return;
        const text = `Je vous invite à voter pour notre prochain débat !\n\nRejoignez avec le code: ${currentSession.code}\n\n${currentSession.shareUrl}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
      }

      // === REJOINDRE UNE SESSION ===

      async function joinSession() {
        const code = document.getElementById('join-code').value.trim().toUpperCase();
        const name = document.getElementById('participant-name').value.trim();

        if (!code || code.length !== 6) {
          showToast('Entrez un code de session valide (6 caractères)', 'error');
          return;
        }
        if (!name) {
          showToast('Entrez votre prénom', 'error');
          return;
        }

        try {
          const result = await apiCall('get', 'GET', { code });
          currentSession = result.session;
          currentSession.participantName = name;

          // Afficher l'interface de vote
          document.getElementById('join-session-form').closest('.session-box').style.display = 'none';
          document.getElementById('vote-interface').style.display = 'block';
          document.getElementById('vote-session-name').textContent = currentSession.name;

          renderVoteArticles();

        } catch (error) {
          showToast(error.message, 'error');
        }
      }

      function renderVoteArticles() {
        const container = document.getElementById('vote-article-list');
        const maxVotes = currentSession.maxVotes;

        let html = '';
        currentSession.articles.forEach(slug => {
          const isVoted = votedArticles.includes(slug);

          html += `
            <div class="article-item ${isVoted ? 'article-item--selected' : ''}" data-slug="${slug}">
              <div class="article-item__checkbox">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <div class="article-item__content">
                <span class="article-item__title">${getArticleTitle(slug)}</span>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
        container.querySelectorAll('.article-item').forEach(item => {
          item.addEventListener('click', () => toggleVote(item.dataset.slug));
        });

        updateVoteLimit();
      }

      function toggleVote(slug) {
        const maxVotes = currentSession.maxVotes;
        const idx = votedArticles.indexOf(slug);

        if (idx === -1) {
          if (votedArticles.length >= maxVotes) {
            showToast(`Maximum ${maxVotes} votes autorisés`, 'error');
            return;
          }
          votedArticles.push(slug);
        } else {
          votedArticles.splice(idx, 1);
        }

        renderVoteArticles();
      }

      function updateVoteLimit() {
        const maxVotes = currentSession.maxVotes;
        const remaining = maxVotes - votedArticles.length;
        const limitEl = document.getElementById('vote-limit');
        const countEl = document.getElementById('votes-remaining');

        countEl.textContent = remaining;
        limitEl.classList.toggle('vote-limit--exceeded', remaining === 0);
      }

      async function submitVotes() {
        if (votedArticles.length === 0) {
          showToast('Sélectionnez au moins un article', 'error');
          return;
        }

        try {
          const result = await apiCall('vote', 'POST', {
            code: currentSession.code,
            participantName: currentSession.participantName,
            participantToken,
            votes: votedArticles
          });

          // Sauvegarder le token
          participantToken = result.participantToken;
          localStorage.setItem('debate-participant-token', participantToken);
          localStorage.setItem(`debate-votes-${currentSession.code}`, JSON.stringify(votedArticles));

          // Afficher confirmation
          document.getElementById('vote-interface').style.display = 'none';
          document.getElementById('vote-submitted').style.display = 'block';

          showToast(`${result.votesRegistered} vote(s) enregistré(s) !`);

        } catch (error) {
          showToast(error.message, 'error');
        }
      }

      // === RÉSULTATS ===

      async function viewResults(code = null) {
        code = code || document.getElementById('results-code').value.trim().toUpperCase();

        if (!code || code.length !== 6) {
          showToast('Entrez un code de session valide', 'error');
          return;
        }

        try {
          const organizerToken = localStorage.getItem(`debate-organizer-${code}`) || '';
          const result = await apiCall('results', 'GET', { code, token: organizerToken });

          currentSession = result.session;

          // Afficher les résultats
          document.getElementById('results-form').closest('.session-box').style.display = 'none';
          document.getElementById('results-display').style.display = 'block';

          document.getElementById('results-session-name').textContent = result.session.name;
          document.getElementById('results-participant-count').textContent = result.participantCount;

          // Graphique des résultats
          const maxVotes = Math.max(...result.results.map(r => r.votes), 1);
          const resultsHtml = result.results.map((r, i) => {
            const percentage = (r.votes / maxVotes) * 100;
            return `
              <div class="vote-result-item">
                <span class="vote-result-item__rank">#${i + 1}</span>
                <div class="vote-result-item__bar">
                  <div class="vote-result-item__fill" style="width: ${percentage}%"></div>
                  <span class="vote-result-item__title">${getArticleTitle(r.slug)}</span>
                </div>
                <span class="vote-result-item__count">${r.votes} vote${r.votes > 1 ? 's' : ''}</span>
              </div>
            `;
          }).join('');

          document.getElementById('vote-results').innerHTML = resultsHtml;

          // Liste des participants
          const participantsHtml = result.participants.map(name =>
            `<span class="participant-tag">${name}</span>`
          ).join('');
          document.getElementById('participants-list').innerHTML = participantsHtml || '<em>Aucun participant</em>';

        } catch (error) {
          showToast(error.message, 'error');
        }
      }

      // === INITIALISATION ===

      async function init() {
        initTabs();

        // Charger les articles
        try {
          const response = await fetch(ARTICLES_URL);
          if (response.ok) {
            const data = await response.json();
            if (data.categories && data.articles) {
              categoriesData = data.categories;
              articlesData = data.articles;
            }
          }
          renderFilters();
          renderArticles();
          loadArticleTitles();
        } catch (e) {
          document.getElementById('article-list').innerHTML =
            '<p style="text-align:center;color:var(--color-text-muted);">Erreur de chargement</p>';
        }

        // Event listeners
        document.getElementById('session-name').addEventListener('input', updateCreateButton);
        document.getElementById('clear-selection').addEventListener('click', clearSelection);
        document.getElementById('create-session-btn').addEventListener('click', createSession);
        document.getElementById('copy-session-link').addEventListener('click', copySessionLink);
        document.getElementById('share-session-whatsapp').addEventListener('click', shareSessionWhatsApp);
        document.getElementById('view-session-results').addEventListener('click', () => {
          document.querySelector('[data-mode="results"]').click();
          document.getElementById('results-code').value = currentSession.code;
          viewResults(currentSession.code);
        });

        document.getElementById('join-session-btn').addEventListener('click', joinSession);
        document.getElementById('submit-votes-btn').addEventListener('click', submitVotes);
        document.getElementById('view-results-after-vote').addEventListener('click', () => {
          document.querySelector('[data-mode="results"]').click();
          document.getElementById('results-code').value = currentSession.code;
          viewResults(currentSession.code);
        });

        document.getElementById('view-results-btn').addEventListener('click', () => viewResults());
        document.getElementById('refresh-results').addEventListener('click', () => viewResults(currentSession.code));
      }

      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
      else init();
    })();
  </script>
</body>
</html>
